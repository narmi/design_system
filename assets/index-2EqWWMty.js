import{r as n}from"./iframe-BZmXFcks.js";import{r as x}from"./raf-schd.esm-CmoV45_-.js";const E=()=>n.useMemo(()=>typeof CSS>"u"||typeof CSS.supports!="function"?!1:[CSS.supports("anchor-name","--my-anchor"),CSS.supports("position-anchor","--my-anchor"),CSS.supports("position-area","bottom center"),CSS.supports("position-try-fallbacks","flip-block")].every(Boolean),[]),R=({anchorRef:r,layerRef:d,matchWidth:s=!1,isOpen:i,setIsOpen:c,isPortalled:l=!1})=>{const p=E();return n.useLayoutEffect(()=>{if(p||!i)return;const t=r.current,o=d.current;if(!t||!o)return;const e=t.getBoundingClientRect(),u=o.getBoundingClientRect();if(e.width===0||u.width===0)return;const h=window.visualViewport?.height||window.innerHeight,f=window.visualViewport?.offsetTop||0,S=h-(e.bottom-f),b=e.top-f,C=u.height>S&&b>S;let v=e.left,y=C?e.top-u.height:e.bottom;if(!l){const a=o.offsetParent;if(a&&a!==document.body){const g=a.getBoundingClientRect();v=e.left-g.left-a.clientLeft,y=y-g.top-a.clientTop}}o.style.setProperty("--js-dropdown-top",`${y}px`),o.style.setProperty("--js-dropdown-left",`${v}px`),o.style.setProperty("--js-dropdown-minWidth","max-content"),s&&o.style.setProperty("--js-dropdown-width",`${e.width}px`);const L=e.top,m=x(()=>{Math.abs(t.getBoundingClientRect().top-L)>20&&c(!1)}),w=()=>c(!1);return window.addEventListener("scroll",m,!0),window.addEventListener("resize",w),window.visualViewport?.addEventListener("resize",w),()=>{m.cancel(),window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",w),window.visualViewport?.removeEventListener("resize",w)}},[p,r,d,s,i,c,l]),{isAnchorPositionSupported:p,polyFillLayerStyles:p?{}:{position:l?"fixed":"absolute",top:"var(--js-dropdown-top)",left:"var(--js-dropdown-left)",minWidth:"var(--js-dropdown-minWidth)",...s&&{width:"var(--js-dropdown-width)"}}}},A=({isOpen:r,setIsOpen:d,matchWidth:s=!0,isPortalled:i=!1})=>{const c=n.useRef(null),l=n.useRef(null),p=n.useId().replaceAll(/:/g,"-"),t=n.useMemo(()=>`--nds-dropdown-anchor-${p}`,[p]),{isAnchorPositionSupported:o,polyFillLayerStyles:e}=R({anchorRef:c,layerRef:l,matchWidth:s,isOpen:r,setIsOpen:d,isPortalled:i}),u=n.useMemo(()=>({ref:c,style:{anchorName:o?t:void 0}}),[c,o,t]),h=n.useMemo(()=>{const f={...o?{position:i?"fixed":"absolute",positionAnchor:t,top:"anchor(bottom)",left:"anchor(start)",positionTryFallbacks:"flip-block",width:"max-content",minWidth:s?"anchor-size(width)":void 0}:e,display:r?"block":"none",zIndex:i?9:4};return{ref:l,style:f}},[r,o,t,s,e,l,i]);return{anchorProps:u,layerProps:h}};export{A as u};
